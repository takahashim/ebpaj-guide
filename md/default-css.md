# デフォルト CSS ファイルについて


## ■スタイルシートの構成

#### 【リフロー型】

```
book-style.css        …… XHTML から呼び出すファイル。
│
│                         各 CSS ファイルの読み込みと、RS の仕様やバグ対策、
│
│                         簡単な作品別カスタマイズ用領域を用意
│
│
│ /* @import で以下の CSS ファイルを読み込み */
│
├ style-reset.css    …… リセット用スタイルシート
│
├ style-standard.css …… 基本のスタイルセット
│
├ style-advance.css  …… 論理方向や組み方向の混在などに対応するためのスタイルセット（除外可）
│
├ (style-***.css)    …… 版元別スタイルセット（各社、必要なら用意。表示は自己責任）
│
└ (style-check.css)  …… Windows のブラウザ環境で、縦組み時にフォントを立てて
                           画面確認するためのスタイル（納品時には読み込みを解除）
```

#### 【固定レイアウト型】

```
fixed-layout-jp.css   …… XHTML ファイルから呼び出すファイル
                           固定レイアウトでは @import がサポートされなくても構わないよう、
                           他のスタイルは利用しない
```

## ■CSS ファイルの運用ルール

#### @import での CSS 読み込み

今回は XHTML ファイル側の記述を統一するため、XHTML ファイルからはメインとなる CSS のみを読み込み、他の CSS ファイルはメイン CSS 内から @import で読み込むこととします。

ただし、ページによって読み込む CSS ファイルを変更したい場合は、この限りではありません。

※特定ページのみ版元別スタイルセットを読み込みたい場合等。

#### デフォルト CSS の改変は原則不可

原則として、事前に用意された CSS ファイルは変更しないものとします。

値の変更が必要なときは「book-style.css」末尾のカスタマイズ領域を使うか、版元別スタイルセットを用意して上書き処理をしてください。

#### 改変・追加は自己責任

本ガイドでは、複雑な指定が必要になるレイアウトを考慮していないので、以下のように CSS 内容そのものを変更する場合には、各自で表示内容に責任を負うこととします。

* class に設定された値を変更
* class にプロパティを追加
* 優先順位変更のため、記述位置を移動
* 他の class と連動している class の名前を変更
* 新たな class を追加
* 版元別スタイルセットを追加

独自 CSS ファイルの読み込み順序は、自由に他と入れ替えて構いません。

作品に不要な class を削除してファイルを軽くしたり、自動化作業のためコメント行をすべて削除する程度であれば動作に支障はありませんが、その際は本来必要なものまで削除してしまわないよう充分注意してください。

必要なら独自の CSS ファイルをいくつ用意しても構いません。
ただし一度に読み込むファイルが重くなりすぎると動作に支障を来す可能性もあるため、対象とする RS の性能などを事前によく確認することを推奨します。

#### id の重複を避ける

id は、本来 各ページ（XHTMLファイル）ごとにユニークであれば構わないものですが、複数ファイルからなる EPUB データの構成を鑑みて、ひとつの作品を通じてユニークな値であるものとします。


## ■定型 class の作成と追加

#### 【概要】

字下げやサイズ指定といった一部のスタイルでは、登録されたものだけでは値が足りない場合が出てくるでしょう。すべてにおいて充分なだけの値を事前登録することは無理なので、デフォルトのスタイルシートセットでは、利用しやすそうな値を少しだけ登録してあります。

たとえば、フォントサイズの指定では、最大 300% までしか登録されていません。400% など事前登録のないサイズが必要になったときは、自分でスタイルを登録する必要があります。

登録する数が多くない場合は、book-style.css の「作品別カスタマイズ領域」を利用してください。

定型 class の場合は、既存の class と同じ書式を使い、値のみを変更した class を登録することを推奨します。なるべく後から他の人が見たときに、何のための class かわかるようにしておいてください。

登録する数が多いときや、複数の作品で同じように使いたい class を登録する際は、独自 CSS ファイルを用意して、book-style.css に @import で読み込ませるようにします。

たとえば奥付や、シリーズ共通ページなどのように、定型で使い回すページ専用の class がある場合は、CSS ファイルを別途用意した方が管理しやすいでしょう。



#### 【定型 class の種類】

#### Ａ．縦組みでも横組みでも中身を変える必要のない項目

たとえばフォントサイズや色指定などは、縦組みでも横組みでも同じ指定が用いられます。
以下は、実際に style-standard.css に登録されているフォントサイズ指定です。

```
---------------------------------[sample code]---------------------------------
.font-1em20 { font-size: 1.20em; }
-------------------------------------------------------------------------------
```

もし、1.25em など、未登録のサイズが必要になったときは、次のように class 名と値の、サイズ数の部分だけ変更したものを新規作成してください。

```
---------------------------------[sample code]---------------------------------
/* -------------------------------------------------------------
 * 作品別カスタマイズ領域
 * ------------------------------------------------------------- */
.font-1em25 { font-size: 1.25em; }
-------------------------------------------------------------------------------
```

小数点以下の値は、上記のように小数点以下２桁まで利用できるものとします。
また、class 名ではドット記号を使うわけにいかないので、整数値を単位の前に、小数値を単位の後に記すこととします。
ただし、小数値がない場合は、次のように整数値のみの class 名としてあります。

```
---------------------------------[sample code]---------------------------------
.font-1em { font-size: 1.00em; }
-------------------------------------------------------------------------------
```

なお、パーセント表記による class の場合は、以下のように３桁で揃えた class 名を用います。

```
---------------------------------[sample code]---------------------------------
.font-085per { font-size: 85%; }
-------------------------------------------------------------------------------
```

#### Ｂ．縦組みと横組みで中身を変える必要がある項目

たとえば、ぶら下がりインデントの指定では、縦組みのときは上からの padding、横組みのときは左からの padding を利用することで、常に同じ class 名で行頭からのインデントが行われるようになっています。

以下は、実際に style-standard.css に登録されているぶらさがりインデント指定です。

```
---------------------------------[sample code]---------------------------------
.hltr .h-indent-1em { text-indent: -1em; padding-left: 1em; }
.vrtl .h-indent-1em { text-indent: -1em; padding-top:  1em; }
-------------------------------------------------------------------------------
```

横組みのときに適用したい class の前には「.hltr」と半角スペースを、縦組みのときは「.vrtl」と半角スペースを、それぞれ追加してください。



#### 【参考情報】※本ガイドでは非推奨項目

#### Ｃ．縦組みと横組みで中身が変わる項目の、組み方向入れ子対策

縦組みと横組みが混在する場合、Ｂの指定だけでは表示が崩れることがあります。

たとえば、横組みのページ内で縦組みのブロックを作成した場合、その中で上記のぶらさがりインデントを行うと、横組み用の左からのパディングと、縦組み用の上からのパディングが同時に適用されてしまいます。

この状態を解消するためには、横組み用の左からのパディングを削除しなければなりません。
以下は、横組みの中に縦組みが出てきたときに、左からのパディングをゼロにする指定と、縦組みの中に横組みが出てきたときに、上からのパディングをゼロにする指定です。

```
---------------------------------[sample code]---------------------------------
.hltr .vrtl .h-indent-1em { padding-left: 0; }
.vrtl .hltr .h-indent-1em { padding-top:  0; }
-------------------------------------------------------------------------------
```

ただしこの方法には欠点もあります。それは、インデント指定とは別に、左からのパディングを指定したい場合です。
このようなケースに対処するのは困難ですので、実際の利用では、以下のようにインデント指定とそれ以外のパディング指定は、同じ要素内で同時に指定しないようにするのが安全です。

```
---------------------------------[sample code]---------------------------------
<div class="p-top-2em">
<div class="h-indent-1em">
<p>テキスト</p>
</div>
</div>
-------------------------------------------------------------------------------
```

なお、以下のように記述すると、一見入れ子対策が不要のように思えますが、実際には、横組み中の縦組みでは大丈夫でも、縦組み中の横組みでは表示が崩れるという状態になります。

```
---------------------------------[sample code]---------------------------------
.hltr .h-indent-1em  { text-indent: -1em; padding: 0 0 0 1em; }
.vrtl .h-indent-1em  { text-indent: -1em; padding: 1em 0 0 0; }
-------------------------------------------------------------------------------
```

上下の行の記載順を入れ替えると、今度は横組み中の縦組みで表示が崩れるようになります。
これは、後から読み込んだスタイルのほうが優先されるという、CSS のルールが原因です。

同様の理由で、本ガイドのデフォルト CSS でも、組み方向の入れ子が２回になってしまうと表示が崩れてしまいます。

どうしても組み方向の混在を利用したい場合は、充分な検証を行ってください。

ぶら下がりインデントのほかに、字下げや字上げ、マージン・パディング・罫線などの論理方向 class や、傍線、リンク下線、画像のベースラインなど縦横で表示が切り替わる class で、こうした組み方向混在による問題が発生します。


## ■カスタマイズ

.book-style.css には、いくつかの上書き用 class と、空の class があらかじめ用意されています。

たとえばリンクの線を消したい場合は、以下のように、上書き用 class を利用してください。

```
---------------------------------[sample code]---------------------------------
/* 基本設定（上：横組み 下：縦組み） */
.hltr a {
}
.vrtl a {
}
-------------------------------------------------------------------------------
 ↓
---------------------------------[sample code]---------------------------------
/* 基本設定（上：横組み 下：縦組み） */
.hltr a {
  text-decoration: none;
}
.vrtl a {
  text-decoration: none;
}
-------------------------------------------------------------------------------
```

※組み方向混在の対策をする場合は追記してください。

空の class を利用する際は、各自の責任において、対象とする RS での充分な検証を行ってください。
より多くの RS での表示を安全なものにしたい場合は、本ガイドで想定される範囲内での CSS プロパティ以外は用いず、また複雑すぎる指定はしないことを推奨します。


なお、下記のように book-style.css のカスタマイズ領域で書体や文字サイズ指定をした HTML 要素や class が指定された要素に、XHTML 上で他の書体指定や文字サイズ指定をしてもうまく反映されないことがあります。

```
---------------------------------[sample code]---------------------------------
.hltr .oo-midashi {
  font-size: 1.5em;
}
.vrtl .oo-midashi {
  font-size: 1.5em;
}

<h1 class="oo-midashi font-100per">見出し</h1>  // 100% ではなく 150% で表示されます。
-------------------------------------------------------------------------------
```

これは、CSS の優先順位によるものです。対処が困難な場合は、新たに class を作成するなどしてください。


## ■独自 CSS ファイルの作成

基本ルールとして、UTF-8（ BOM 無し）で保存すること、またファイルの先頭に「@charset "UTF-8";」と必ず挿入することを推奨します。
